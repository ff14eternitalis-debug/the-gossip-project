<div class="container mt-5">
  <h1>Recherche</h1>

  <%= form_tag search_path, method: :get, class: "mt-3" do %>
    <div class="input-group mb-4">
      <%= text_field_tag :q, @query, class: "form-control", placeholder: "Rechercher un potin, un utilisateur, un tag..." %>
      <%= submit_tag "Rechercher", class: "btn btn-primary" %>
    </div>
  <% end %>

  <% if @query.present? %>
    <% total = @gossips.size + @users.size + @tags.size %>
    <p class="text-muted"><%= total %> resultat<%= "s" if total != 1 %> pour "<%= @query %>"</p>

    <% if @gossips.any? %>
      <h3 class="mt-4">Potins</h3>
      <div class="list-group mb-4">
        <% @gossips.each do |gossip| %>
          <%= link_to gossip_path(gossip), class: "list-group-item list-group-item-action" do %>
            <div class="d-flex justify-content-between">
              <strong><%= gossip.title %></strong>
              <small class="text-muted">par <%= gossip.user.first_name %></small>
            </div>
            <p class="mb-0 small text-muted"><%= truncate(gossip.content, length: 100) %></p>
          <% end %>
        <% end %>
      </div>
    <% end %>

    <% if @users.any? %>
      <h3 class="mt-4">Utilisateurs</h3>
      <div class="list-group mb-4">
        <% @users.each do |user| %>
          <%= link_to user_path(user), class: "list-group-item list-group-item-action d-flex align-items-center gap-2" do %>
            <%= user_avatar(user, size: 28) %>
            <span><%= user.first_name %> <%= user.last_name %></span>
          <% end %>
        <% end %>
      </div>
    <% end %>

    <% if @tags.any? %>
      <h3 class="mt-4">Tags</h3>
      <p>
        <% @tags.each do |tag| %>
          <%= link_to tag.title, tag_path(tag), class: "badge bg-secondary text-decoration-none fs-6" %>
        <% end %>
      </p>
    <% end %>

    <% if total == 0 %>
      <p class="text-muted">Aucun resultat trouve.</p>
    <% end %>
  <% end %>
</div>
