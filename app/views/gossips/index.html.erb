<div class="container mt-5">
  <h1>Bienvenue sur The Gossip Project</h1>
  <p class="lead">Decouvrez les derniers potins !</p>

  <% if user_signed_in? %>
    <div class="mb-3">
      <%= link_to "Nouveau potin", new_gossip_path, class: "btn btn-success" %>
    </div>
  <% end %>

  <div class="row mt-4">
    <% @gossips.each do |gossip| %>
      <div class="col-md-4 mb-4">
        <div class="card h-100">
          <div class="card-body">
            <h5 class="card-title"><%= gossip.title %></h5>
            <p class="card-text text-muted small d-flex align-items-center gap-1">
              <%= user_avatar(gossip.user, size: 20) %>
              Par <%= link_to gossip.user.first_name, user_path(gossip.user), class: "text-decoration-none text-muted" %> — <%= gossip.created_at.strftime("%d/%m/%Y") %>
            </p>
            <p class="card-text"><%= truncate(gossip.content, length: 120) %></p>
            <p class="card-text small text-muted">
              <%= gossip.comments.size %> commentaire<%= "s" if gossip.comments.size != 1 %> —
              <%= gossip.likes.size %> like<%= "s" if gossip.likes.size != 1 %>
              <% if user_signed_in? %>
                <% user_like = gossip.likes.find_by(user: current_user) %>
                <% if user_like %>
                  <%= button_to "Unlike", like_path(user_like), method: :delete, form: { class: "d-inline" }, class: "btn btn-link btn-sm p-0 align-baseline" %>
                <% else %>
                  <%= button_to "Like", likes_path(likeable_type: "Gossip", likeable_id: gossip.id), method: :post, form: { class: "d-inline" }, class: "btn btn-link btn-sm p-0 align-baseline" %>
                <% end %>
              <% end %>
            </p>
            <% if gossip.tags.any? %>
              <p class="card-text small">
                <% gossip.tags.each do |tag| %><%= link_to tag.title, tag_path(tag), class: "badge bg-secondary text-decoration-none" %> <% end %>
              </p>
            <% end %>
          </div>
          <div class="card-footer">
            <%= link_to "Voir plus", gossip_path(gossip), class: "btn btn-primary btn-sm" %>
          </div>
        </div>
      </div>
    <% end %>
  </div>

  <%== pagy_bootstrap_nav(@pagy) if @pagy.pages > 1 %>
</div>
