<div class="container mt-5">
  <h1>Nouveau message</h1>

  <% if @message.errors.any? %>
    <div class="alert alert-danger mt-3">
      <ul class="mb-0">
        <% @message.errors.full_messages.each do |msg| %>
          <li><%= msg %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <%= form_with model: @message, url: conversations_path, local: true, class: "mt-4" do |f| %>
    <div class="mb-3">
      <label class="form-label" for="recipient_search">Destinataire(s)</label>
      <div data-controller="autocomplete"
           data-autocomplete-users-value="<%= @users.map { |u| { id: u.id, first_name: u.first_name, last_name: u.last_name.to_s } }.to_json %>"
           data-autocomplete-preselected-value="<%= @recipient ? { id: @recipient.id.to_s, name: "#{@recipient.first_name} #{@recipient.last_name}" }.to_json : "{}" %>"
           style="max-width: 400px; position: relative;">
        <div data-autocomplete-target="selected" class="d-flex flex-wrap gap-1 mb-1" aria-live="polite"></div>
        <input type="text"
               id="recipient_search"
               data-autocomplete-target="input"
               data-action="input->autocomplete#search focus->autocomplete#search"
               class="form-control"
               placeholder="Rechercher un ami..."
               autocomplete="off"
               aria-autocomplete="list"
               aria-haspopup="listbox">
        <div data-autocomplete-target="dropdown" class="autocomplete-dropdown d-none"></div>
        <div data-autocomplete-target="hiddenInputs"></div>
      </div>
    </div>

    <div class="mb-3">
      <%= f.label :content, "Message", class: "form-label" %>
      <%= f.text_area :content, class: "form-control", rows: 5 %>
    </div>

    <button type="submit" class="button button--primary button--take-off">
      <span class="icon">
        <div class="svg-wrapper">
          <img src="/send.svg" width="20" height="20" alt="">
        </div>
      </span>
      <span>Envoyer</span>
    </button>
    <%= link_to "Annuler", conversations_path, class: "btn btn-outline-secondary ms-2" %>
  <% end %>
</div>
